<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>HackMD Converter</title>
<style>
body { font-family: Arial, sans-serif; padding: 30px; background: #f3f3f3; }
h1, h2, h3 { color: #333; text-align:center; }
input { width: 60%; padding: 8px; }
button { padding: 8px 12px; margin-left: 10px; }
textarea { width: 100%; height: 300px; margin-top: 20px; }
.upload-box { margin-top:20px; padding:15px; background:#fff; border-radius:8px; }
</style>
</head>
<body>

<h1>HackMD ç­†è¨˜ä¸‹è¼‰å·¥å…·</h1>
<h2>ğŸ§  <font color=blue>è¼¸å…¥ HackMD ç­†è¨˜ç¶²å€</font>ï¼Œæˆ– <font color=blue>ä¸Šå‚³æ•™ææª”æ¡ˆ</font>è‡ªå‹•è§£æ</h2>
<center><font color=red size="5"> â€¼ï¸ ç¶²é è£½ä½œç´”å±¬å­¸ç¿’åˆ†äº«ï¼Œä½¿ç”¨è³‡æ–™è«‹å°Šé‡åŸä½œè€…æ™ºæ…§è²¡ç”¢æ¬Šâ€¼ï¸</font></center>
<hr>

<!-- HackMD URL -->
<font color=blue size=4>ğŸŒŸ è«‹è¼¸å…¥é è½‰æ›çš„ HackMD ç­†è¨˜ç¶²å€ï¼š</font><br>
<input type="text" id="urlInput" placeholder="è¼¸å…¥ HackMD ç¶²å€... ä¾‹å¦‚ https://hackmd.io/@user/note">
<button onclick="downloadNote()">ä¸‹è¼‰ Markdown</button>
<p><font color=red size="4">ğŸ’¡ ç¶²å€è¼¸å…¥å°æŠ€å·§ï¼š</font><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ‘‰ è¼¸å…¥ https://hackmd.io/@ä½œè€…å¸³è™Ÿ â¡ï¸ è‡ªå‹•ä¸‹è¼‰å…¨éƒ¨ç­†è¨˜<font color="#E0E0E0" size=2>ï¼ˆe.g. https://hackmd.io/@johnsonnoteï¼‰</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ‘‰ è¼¸å…¥ https://hackmd.io/@ä½œè€…å¸³è™Ÿ/æ–‡ç« æ¨™é¡Œ â¡ï¸ ä¸‹è¼‰å–®ç¯‡<font color="#E0E0E0" size=2>ï¼ˆe.g. https://hackmd.io/@johnsonnote/ai_llmï¼‰</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ‘‰ è¼¸å…¥ https://hackmd.io/@ä½œè€…å¸³è™Ÿ/collection/xxx â¡ï¸ ä¸‹è¼‰å…¨éƒ¨åˆé›†<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ‘‰ è¼¸å…¥ https://hackmd.io/@jä½œè€…å¸³è™Ÿ?view=all â¡ï¸ ä¸‹è¼‰å…¨éƒ¨<br>

<hr>

<!-- ä¸Šå‚³æœ¬åœ°æª”æ¡ˆ -->
<font size=4>æˆ–</font><br>
<font color=blue size=4>ğŸ“ è«‹ä¸Šå‚³æ•™æï¼ˆ.html / .mdï¼‰ï¼š</font><br>
<div class="upload-box">
    <input type="file" id="fileInput" accept=".html,.htm,.md,.txt">
    <button onclick="processFile()">è§£ææ•™æ â†’ ä¸‹è¼‰æ‰€æœ‰ç­†è¨˜</button>
</div>

<hr>

<!-- é¡¯ç¤ºæŠ“åˆ°çš„ Markdown å…§å®¹ -->
<font color=blue size=4>ğŸ“‹ é¡¯ç¤º Markdown</font><br>
<textarea id="output" placeholder="ç­†è¨˜å…§å®¹ Markdown èªæ³•æœƒé¡¯ç¤ºåœ¨é€™è£¡"></textarea>

<script>
/* ================================================
    ä¸‹è¼‰å–®ç¯‡ HackMD
================================================ */
async function downloadNote(urlOverride=null) {
    const url = urlOverride || document.getElementById('urlInput').value.trim();
    if(!url) { alert("è«‹è¼¸å…¥ HackMD ç¶²å€"); return; }

    const output = document.getElementById('output');
    output.value = "æ­£åœ¨ä¸‹è¼‰ç­†è¨˜...\n";

    try {
        let notePath = new URL(url).pathname.replace(/^\/+/,'');

        let downloadUrl = `https://hackmd.io/${notePath}/download`;

        const response = await fetch(downloadUrl);
        if(!response.ok) throw new Error(`HTTP ${response.status}`);

        const mdText = await response.text();
        output.value = mdText;

        // ä¸‹è¼‰ .md
        const safeTitle = notePath.replace(/[\/\\:*?"<>|]/g, "_");
        const blob = new Blob([mdText], {type: "text/markdown;charset=utf-8"});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = safeTitle + ".md";
        link.click();

    } catch (err) {
        output.value = "";
        alert("ä¸‹è¼‰å¤±æ•—ï¼š" + err);
    }
}

/* ================================================
    å¾æ•™ææª”æ¡ˆæŠ“å‡ºæ‰€æœ‰ HackMD é€£çµ
================================================ */
function processFile() {
    const fileInput = document.getElementById("fileInput");
    if (!fileInput.files.length) {
        alert("è«‹é¸æ“‡æ•™ææª”æ¡ˆï¼");
        return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();

    reader.onload = async function(e) {
        const text = e.target.result;

        // æŠ“æ‰€æœ‰ hackmd.io é€£çµ
        const regex = /https?:\/\/hackmd\.io\/[^\s)'"<>]+/g;
        const links = text.match(regex) || [];

        if (links.length === 0) {
            alert("æœªåœ¨æ•™æä¸­æ‰¾åˆ°ä»»ä½• HackMD ç­†è¨˜é€£çµï¼");
            return;
        }

        alert(`æ‰¾åˆ° ${links.length} å€‹ HackMD é€£çµï¼Œé–‹å§‹ä¸‹è¼‰...`);

        for (let url of links) {
            await downloadNote(url);
            await new Promise(r => setTimeout(r, 500)); // é™ä½è«‹æ±‚é »ç‡
        }

        alert("å…¨éƒ¨ç­†è¨˜å·²ä¸‹è¼‰å®Œç•¢ï¼");
    };

    reader.readAsText(file, "utf-8");
}
</script>

</body>
</html>

